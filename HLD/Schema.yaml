openapi: 3.0.3
info:
  title: Ski Rent Api
  version: "0.1"
tags:
  - name: Items
    description: Operations related to items
  - name: Maintenances
    description: Operations related to maintenances
  - name: Availability
    description: Operations related to item availability for rental
  - name: Rentals
    description: Operations related to rentals
servers:
  - url: http://localhost:8080
paths:
  /items:
    post:
      tags:
        - Items
      summary: Add new item
      requestBody:
        required: true
        content:
          application/json:
            schema:
             $ref: '#/components/schemas/Request_AddItem'
      responses:
        '200':
          description: Item added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetId'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
    get:
      tags:
        - Items
      summary: Get multiple items paginated and filtered
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          required: false
        - in: query
          name: from
          schema:
            type: string
            format: date-time
          required: true
        - in: query
          name: to
          schema:
            type: string
            format: date-time
          required: true
        - in: query
          name: size
          schema:
            type: integer
            default: 1
            minimum: 1
            maximum: 100
          required: false
        - in: query
          name: category
          schema:
            type: array
            items:
              type: string
          required: false
        - in: query
          name: damaged
          schema:
            type: boolean
          required: false
      responses:
        '200':
          description: Item retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetMultipleItems'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
  /items/{id}:
    get:
      tags:
        - Items
      summary: Get single item by Id
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Item retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetSingleItem'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
    put:
      summary: Update item by id
      tags:
        - Items
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Request_UpdateItem'
      responses:
        '200':
          description: Item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetSingleItem'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
    delete:
      summary: Delete item by id
      tags:
        - Items
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Item deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetId'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
  /items/{id}/maintenances:
    post:
      summary: Add maintenance to item
      tags:
        - Maintenances
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
             $ref: '#/components/schemas/Request_AddMaintenance'
      responses:
        '200':
          description: Maintenance record created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetSingleMaintenance'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
    get:
      summary: Get maintenance records for item
      tags:
        - Maintenances
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          required: false
        - in: query
          name: size
          schema:
            type: integer
            default: 1
            minimum: 1
            maximum: 100
          required: false
        - in: query
          name: type
          schema:
            $ref: '#/components/schemas/MaintenanceTypeEnum'
          required: false
      responses:
        '200':
          description: Maintenances retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetMultipleMaintenances'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
  /maintenances:
    get:
      summary: Get multiple maintenances paginated and filtered
      tags:
        - Maintenances
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          required: false
        - in: query
          name: size
          schema:
            type: integer
            default: 1
            minimum: 1
            maximum: 100
          required: false
        - in: query
          name: type
          schema:
            $ref: '#/components/schemas/MaintenanceTypeEnum'
          required: false
      responses:
        '200':
          description: Get multiple maintenance records
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetMultipleMaintenances'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
  /maintenances/{id}:
    get:
      summary: Get single maintenance record by id
      tags:
        - Maintenances
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Maintenance retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetSingleMaintenance'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
    put:
      summary: Update maintenance record by id
      tags:
        - Maintenances
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Request_UpdateMaintenance'
      responses:
        '200':
          description: Maintenance updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetSingleMaintenance'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
    delete:
      summary: Delete maintenance record by id
      tags:
        - Maintenances
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Maintenance deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetId'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
  /shop/itemRefresh:
    get:
      summary: Get items availabilable in specific time window via only DB
      tags:
        - Availability
      parameters:
        - in: query
          name: page
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - in: query
          name: size
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - in: query
          name: category
          required: false
          schema:
            type: array
            items:
              type: string
        - in: query
          name: from
          required: true
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          required: true
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Successfully retrieved item data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetMultipleItems'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
  /shop/itemCheck:
    post:
      tags:
        - Availability
      description: Check selected items in DB and cache. Generate shop token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Request_ItemCheck'
      responses:
        '200':
          description: Successfully retrieved data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ItemCheck'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'
  /shop/itemShop:
    post:
      tags:
        - Availability
      description: Endpoint for item shop
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Request_ItemShop'
      responses:
        '204':
          description: Response of created rental id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetId'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_Error'

components:
  schemas:
    CurrentDate:
      description: Current date
      type: string
      format: date-time
    Error:
      description: Returned error
      type: object
      required:
        - category
        - type
        - fieldValue
      properties:
        category:
          description: Error category
          type: string
          example: Input Error
        message:
          description: Error type
          type: string
          example: Empty Field
        fieldPath:
          description: Error path
          type: string
          example: buyer
        fieldName:
          description: Error name
          type: string
          example: phone
        fieldValue:
          description: Error value
          type: string
          example: []
    Errors:
      description: Returned errors
      type: array
      items:
        $ref: '#/components/schemas/Error'
    RentalStatusTypeEnum:
      description: Rental status
      enum:
      - RESERVED
      - CANCELED
      - FINISHED
      example: RESERVED
    MaintenanceTypeEnum:
      description: Maintenance type enum
      enum:
      - INFO
      - REPAIR
      - DAMAGE
      example: INFO
    Price:
      description: Price schema
      required:
        - priceAmount
        - priceCurrency
      properties:
        priceAmount:
          type: number
          description: Price amount
          example: 99.99
        priceCurrency:
          type: string
          description: Price currency
          pattern: '^[A-Z]{3}$'
          example: PLN
    Pages:
      description: Schema for page
      type: object
      properties:
        currentPage:
          description: Current page
          type: integer
          example: 5
        currentSize:
          description: CurrentSize
          type: integer
          example: 4
        maxPage:
          description: Last page with info for current size
          type: integer
          example: 2
    RentalDate:
      description: Rental date range
      required:
        - from
        - to
      properties:
        from:
          type: string
          format: date-time
          example: "2025-12-12-19:30"
        to:
          type: string
          format: date-time
          example: "2025-12-12-22:00"

    Request_AddItem:
      description: Schema for adding new item
      type: object
      required:
        - name
        - category
        - price
      properties:
        name:
          description: Visible name of item
          type: string
          example: Pink helmet
        category:
          description: Item category
          type: string
          example: Ski
        price:
          $ref: '#/components/schemas/Price'
    Request_UpdateItem:
      description: Schema for updating existing item
      type: object
      properties:
        name:
          type: string
          example: Pink Ski
        category:
          type: string
          example: Ski
        price:
          $ref: '#/components/schemas/Price'
    Request_AddMaintenance:
      description: Schema for adding new maintenance
      type: object
      required:
        - type
        - note
      properties:
        type:
          $ref: '#/components/schemas/MaintenanceTypeEnum'
        note:
          type: string
          example: Everything is ok
    Request_UpdateMaintenance:
      description: Schema for meintenance record update
      required:
        - note
      properties:
        note:
          type: string
          example: Everything is OK
    Request_ItemCheck:
      description: Request to check selected items.
      required:
        - rental
        - items
      properties:
        token:
          type: string
          format: uuid
        rental:
          $ref: '#/components/schemas/RentalDate'
        items:
          type: array
          items:
            type: integer
            format: int64
          minimum: 1
          maximum: 100
    Request_ItemShop:
      description: Request to shop selected items. Require itemCheck before
      required:
        - token
        - rental
        - items
        - paid
        - buyer
      properties:
        token:
          type: string
          format: uuid
        rental:
          $ref: '#/components/schemas/RentalDate'
        items:
          type: array
          items:
            type: integer
            format: int64
          minimum: 1
          maximum: 100
        paid:
          $ref: '#/components/schemas/Price'
        buyer:
          $ref: '#/components/schemas/BuyerEntity'

    ItemEntity:
      description: Returned item record
      type: object
      required:
        - id
        - name
        - category
        - addDate
        - lastMaintenance
        - damaged
      properties:
        id:
          description: Item id
          type: integer
          format: int64
          example: 21
        name:
          description: Item name
          type: string
          example: Pink helmet
        category:
          description: Item category
          type: string
          example: Ski
        addDate:
          description: Item add date
          $ref: '#/components/schemas/CurrentDate'
        lastMaintenance:
          description: Item last maintenance date
          $ref: '#/components/schemas/CurrentDate'
        damaged:
          description: Item damaged status
          type: boolean
          example: false
        price:
          $ref: '#/components/schemas/Price'
    MaintenanceEntity:
      description: Schema of maintenance record
      type: object
      required:
        - id
        - itemId
        - type
        - date
        - note
      properties:
        id:
          type: integer
          format: int64
          description: Maintenance id
          example: 15
        itemId:
          type: integer
          format: int64
          description: Item id
          example: 21
        type:
          $ref: '#/components/schemas/MaintenanceTypeEnum'
        date:
          description: Maintenance creation date
          $ref: '#/components/schemas/CurrentDate'
        note:
          type: string
          description: Maintenance note
          example: Everything is ok
    BuyerEntity:
      description: Buyer schema entity
      required:
        - name
        - surname
        - phone
        - pesel
      properties:
        name:
          type: string
          example: Dawid
        surname:
          type: string
          example: Nowak
        phone:
          type: string
          format: phone
          example: 111222333
        pesel:
          type: string
          format: pesel

    Response_Error:
      description: Schema for error response
      required:
        - timestamp
        - errors
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        errors:
          $ref: '#/components/schemas/Errors'
    Response_GetId:
      description: Schema for returning only id
      type: object
      required:
        - timestamp
        - id
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        id:
          type: integer
          format: int64
          description: Changed id
          example: 21
    Response_GetMultipleItems:
      description: Schema for getting multiple items
      type: object
      required:
        - timestamp
        - items
        - pages
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        items:
          type: array
          items:
            $ref: '#/components/schemas/ItemEntity'
        pages:
          $ref: '#/components/schemas/Pages'
    Response_GetSingleItem:
      description: Schema for getting single item
      type: object
      required:
        - timestamp
        - item
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        item:
          $ref: '#/components/schemas/ItemEntity'
    Response_GetSingleMaintenance:
      description: Schema for getting single Maintenance record
      required:
        - timestamp
        - maintenance
      type: object
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        maintenance:
          $ref: '#/components/schemas/MaintenanceEntity'
    Response_GetMultipleMaintenances:
      description: Schema for getting multiple Maintenance records
      required:
        - timestamp
        - maintenance
        - pages
      type: object
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        maintenance:
          type: array
          items:
            $ref: '#/components/schemas/MaintenanceEntity'
        pages:
          $ref: '#/components/schemas/Pages'
    Response_ItemCheck:
      description: Response for itemCheck
      required:
        - timestamp
        - valid
        - notValid
        - token
        - ttl
      properties:
        timestamp:
          $ref: "#/components/schemas/CurrentDate"
        valid:
          type: array
          items:
            $ref: '#/components/schemas/ItemEntity'
        notValid:
          type: array
          items:
            $ref: '#/components/schemas/ItemEntity'
        token:
          type: string
          format: uuid
        ttl:
          type: string
          format: date-time
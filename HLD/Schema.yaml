openapi: 3.0.3
info:
  title: Ski Rent Api
  version: "0.1"
tags:
  - name: Items
    description: Operations related to items
  - name: Maintenances
    description: Operations related to maintenances
  - name: Availability
    description: Operations related to item availability for rental
  - name: Rentals
    description: Operations related to rentals
  - name: Categories
    description: Operations related to categories
  - name: Auth
    description: Operatiosn related to authorization
servers:
  - url: http://localhost:8080
paths:
  /v1/api/items:
    post:
      tags:
        - Items
      summary: Add new item
      requestBody:
        required: true
        content:
          application/json:
            schema:
             $ref: '#/components/schemas/Request_AddItem'
      responses:
        '200':
          description: Item added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetId'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
    get:
      tags:
        - Items
      summary: Get multiple items paginated and filtered
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          required: false
        - in: query
          name: size
          schema:
            type: integer
            default: 1
            minimum: 1
            maximum: 100
          required: false
        - in: query
          name: category
          schema:
            type: string
          required: false
        - in: query
          name: damaged
          schema:
            type: boolean
          required: false
        - in: query
          name: itemSize
          required: false
          schema:
            $ref: "#/components/schemas/SizeEnum"
        - in: query
          name: place
          required: false
          schema:
            $ref: "#/components/schemas/PlacesEnum"
      responses:
        '200':
          description: Item retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetMultipleItems'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
  /v1/api/items/{id}:
    get:
      tags:
        - Items
      summary: Get single item by Id
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Item retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetSingleItem'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
    put:
      summary: Update item by id
      tags:
        - Items
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Request_UpdateItem'
      responses:
        '200':
          description: Item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetSingleItem'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
    delete:
      summary: Delete item by id
      tags:
        - Items
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Item deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetId'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
  /v1/api/items/{id}/maintenances:
    post:
      summary: Add maintenance to item
      tags:
        - Maintenances
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
             $ref: '#/components/schemas/Request_AddMaintenance'
      responses:
        '200':
          description: Maintenance record created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetSingleMaintenance'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
    get:
      summary: Get maintenance records for item
      tags:
        - Maintenances
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          required: false
        - in: query
          name: size
          schema:
            type: integer
            default: 1
            minimum: 1
            maximum: 100
          required: false
        - in: query
          name: types
          schema:
            type: array
            items:
              $ref: '#/components/schemas/MaintenanceTypeEnum'
          required: false
        - in: query
          name: from
          schema:
            type: string
            format: date
        - in: query
          name: to
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Maintenances retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetMultipleMaintenances'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
  /v1/api/maintenances:
    get:
      summary: Get multiple maintenances paginated and filtered
      tags:
        - Maintenances
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          required: false
        - in: query
          name: size
          schema:
            type: integer
            default: 1
            minimum: 1
            maximum: 100
          required: false
        - in: query
          name: types
          schema:
            type: array
            items:
              $ref: '#/components/schemas/MaintenanceTypeEnum'
          required: false
        - in: query
          name: from
          schema:
            type: string
            format: date
        - in: query
          name: to
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Get multiple maintenance records
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetMultipleMaintenances'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
  /v1/api/maintenances/{id}:
    get:
      summary: Get single maintenance record by id
      tags:
        - Maintenances
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Maintenance retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetSingleMaintenance'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
    put:
      summary: Update maintenance record by id
      tags:
        - Maintenances
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Request_UpdateMaintenance'
      responses:
        '200':
          description: Maintenance updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetSingleMaintenance'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
    delete:
      summary: Delete maintenance record by id
      tags:
        - Maintenances
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Maintenance deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetId'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
  /v1/api/shop/itemRefresh:
    get:
      summary: Get items availabilable in specific time window via only DB
      tags:
        - Availability
      parameters:
        - in: query
          name: page
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - in: query
          name: size
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - in: query
          name: category
          required: false
          schema:
            type: string
        - in: query
          name: from
          required: true
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          required: true
          schema:
            type: string
            format: date-time
        - in: query
          name: itemSize
          required: false
          schema:
            $ref: "#/components/schemas/SizeEnum"
        - in: query
          name: place
          required: false
          schema:
            $ref: "#/components/schemas/PlacesEnum"
      responses:
        '200':
          description: Successfully retrieved item data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetMultipleItems'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
  /v1/api/shop/itemCheck:
    post:
      tags:
        - Availability
      description: Check selected items in DB and cache. Generate shop token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Request_ItemCheck'
      responses:
        '200':
          description: Successfully retrieved data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ItemCheck'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
  /v1/api/shop/itemShop:
    post:
      tags:
        - Availability
      description: Endpoint for item shop
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Request_ItemShop'
      responses:
        '204':
          description: Response of created rental id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetId'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
  /v1/api/rentals:
    get:
      summary: Endpoint for getting rentals
      tags:
        - Rentals
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          required: false
        - in: query
          name: size
          schema:
            type: integer
            default: 1
            minimum: 1
            maximum: 100
          required: false
        - in: query
          name: status
          schema:
            $ref: '#/components/schemas/RentalStatusTypeEnum'
          required: false
        - in: query
          name: place
          required: false
          schema:
            $ref: "#/components/schemas/PlacesEnum"
      responses:
        '200':
          description: Call to server for rental was succesfull
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetMultipleRentals'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
  /v1/api/rentals/{id}/close:
    get:
      summary: Endpoint for getting rentals
      tags:
        - Rentals
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Call to close rental was successfull
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
  /v1/api/rentals/{id}:
    get:
      summary: Endpoint for getting rental
      tags:
        - Rentals
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Rental retrieved Successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_GetSingleRental'
        default:
          description: Unexpected Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_ErrorModel'
  /v1/api/categories:
    get:
      tags:
        - Categories
      description: Endpoint for getting current categories
      responses:
        '200':
          description: List of getting categories
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                example: ["ski", "helm", "gloves"]
  /v1/api/login:
    post:
      tags:
        - Auth
      description: Endpoint for login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Request_Login'
      responses:
        '200':
          description: Logged successfully
  /v1/api/register:
    post:
      tags:
        - Auth
      description: Endpoint for register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Request_Register'
      responses:
        '200':
          description: Logged successfully
  /v1/api/me:
    get:
      tags:
        - Auth
      summary: Get jwt token info
      responses:
        '200':
          description: JWT read successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response_AuthMe'
  /v1/api/logout:
    post:
      tags:
        - Auth
      summary: Endpoint for logging out (not possible to modify httponly cookie otherwise)
      responses:
        '200':
          description: Logged successfully

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    CurrentDate:
      description: Current date
      type: string
      format: date-time
    ErrorModel:
      description: Returned error
      type: object
      required:
        - category
        - type
        - fieldValue
      properties:
        category:
          description: Error category
          type: string
          example: Input Error
        message:
          description: Error type
          type: string
          example: Empty Field
        fieldPath:
          description: Error path
          type: string
          example: buyer
        fieldName:
          description: Error name
          type: string
          example: phone
        fieldValue:
          description: Error value
          type: string
          example: []
    ErrorsModel:
      description: Returned errors
      type: array
      items:
        $ref: '#/components/schemas/ErrorModel'
    RentalStatusTypeEnum:
      description: Rental status
      enum:
      - RESERVED
      - CANCELED
      - FINISHED
      example: RESERVED
    MaintenanceTypeEnum:
      description: Maintenance type enum
      enum:
      - INFO
      - REPAIR
      - DAMAGE
      example: INFO
    Price:
      description: Price schema
      required:
        - priceAmount
        - priceCurrency
      properties:
        priceAmount:
          type: number
          description: Price amount
          example: 99.99
        priceCurrency:
          type: string
          description: Price currency
          pattern: '^[A-Z]{3}$'
          example: PLN
    Pages:
      description: Schema for page
      type: object
      properties:
        currentPage:
          description: Current page
          type: integer
          example: 5
        currentSize:
          description: CurrentSize
          type: integer
          example: 4
        numberOfPages:
          description: Last page with info for current size
          type: integer
          example: 2
    RentalDate:
      description: Rental date range
      required:
        - from
        - to
      properties:
        from:
          type: string
          format: date-time
          example: "2025-12-12-19:30"
        to:
          type: string
          format: date-time
          example: "2025-12-12-22:00"
    SizeEnum:
      description: Available sizes enum
      enum:
      - "S"
      - "M"
      - "L"
      - "XL"
      - "2XL"
    PlacesEnum:
      description: Available places enum
      enum:
      - "Bialka Tatrzanska, PL"
      - "Krakow, PL"
      - "Kranjska Gora, SI"
      - "Foppolo, IT"
    RankEnum:
      description: Enum for rank of person
      enum:
        - USER
        - WORKER
        - ADMIN

    Request_Register:
      type: object
      required:
        - login
        - password
        - name
        - surname
        - phone
      properties:
        login:
          type: string
          example: user123
        password:
          type: string
          format: password
          example: Abc123
        name:
          type: string
          example: Tomek
        surname:
          type: string
          example: Nowak
        phone:
          type: string
    Request_Login:
      type: object
      required:
        - loginOrPhone
        - password
      properties:
        loginOrPhone:
          type: string
          example: User123
        password:
          type: string
          format: password
          example: Abc123
    Request_AddItem:
      description: Schema for adding new item
      type: object
      required:
        - name
        - place
        - size
        - image
        - category
        - price
      properties:
        name:
          description: Visible name of item
          type: string
          example: Pink helmet
        place:
          description: Where item is
          $ref: "#/components/schemas/PlacesEnum"
        size:
          description: Item size
          $ref: '#/components/schemas/SizeEnum'
        image:
          description: Path to image
          type: string
          example: "/Placeholder.png"
        category:
          description: Item category
          type: string
          example: Ski
        price:
          $ref: '#/components/schemas/Price'
    Request_UpdateItem:
      description: Schema for updating existing item
      type: object
      properties:
        name:
          type: string
          example: Pink Ski
        category:
          type: string
          example: Ski
        place:
          description: Where item is
          $ref: "#/components/schemas/PlacesEnum"
        size:
          description: Item size
          $ref: '#/components/schemas/SizeEnum'
        price:
          $ref: '#/components/schemas/Price'
    Request_AddMaintenance:
      description: Schema for adding new maintenance
      type: object
      required:
        - type
        - note
      properties:
        type:
          $ref: '#/components/schemas/MaintenanceTypeEnum'
        note:
          type: string
          example: Everything is ok
    Request_UpdateMaintenance:
      description: Schema for meintenance record update
      required:
        - note
      properties:
        note:
          type: string
          example: Everything is OK
    Request_ItemCheck:
      description: Request to check selected items.
      required:
        - rental
        - items
      properties:
        token:
          type: string
          format: uuid
        rental:
          $ref: '#/components/schemas/RentalDate'
        items:
          type: array
          items:
            type: integer
            format: int64
          minimum: 1
          maximum: 100
    Request_ItemShop:
      description: Request to shop selected items. Require itemCheck before
      required:
        - token
        - rental
        - items
        - paid
      properties:
        token:
          type: string
          format: uuid
        rental:
          $ref: '#/components/schemas/RentalDate'
        items:
          type: array
          items:
            type: integer
            format: int64
          minimum: 1
          maximum: 100
        paid:
          $ref: '#/components/schemas/Price'
        buyer:
          description: Optional buyer info override for account
          $ref: '#/components/schemas/BuyerEntity'

    ItemEntity:
      description: Returned item record
      type: object
      required:
        - id
        - name
        - image
        - place
        - size
        - category
        - addDate
        - lastMaintenance
        - damaged
      properties:
        id:
          description: Item id
          type: integer
          format: int64
          example: 21
        image:
          description: link fo image
          type: string
        name:
          description: Item name
          type: string
          example: Pink helmet
        place:
          description: Where item is
          $ref: "#/components/schemas/PlacesEnum"
        size:
          description: Item size
          $ref: '#/components/schemas/SizeEnum'
        category:
          description: Item category
          type: string
          example: Ski
        addDate:
          description: Item add date
          $ref: '#/components/schemas/CurrentDate'
        lastMaintenance:
          description: Item last maintenance date
          $ref: '#/components/schemas/CurrentDate'
        damaged:
          description: Item damaged status
          type: boolean
          example: false
        price:
          $ref: '#/components/schemas/Price'
    MaintenanceEntity:
      description: Schema of maintenance record
      type: object
      required:
        - id
        - itemName
        - itemId
        - itemImage
        - type
        - date
        - note
      properties:
        id:
          type: integer
          format: int64
          description: Maintenance id
          example: 15
        itemName:
          type: string
          description: Item name
          example: Pink Helmet
        itemId:
          type: integer
          format: int64
          example: 7
        itemImage:
          type: string
        type:
          $ref: '#/components/schemas/MaintenanceTypeEnum'
        date:
          description: Maintenance creation date
          $ref: '#/components/schemas/CurrentDate'
        note:
          type: string
          description: Maintenance note
          example: Everything is ok
    BuyerEntity:
      description: Buyer schema entity
      required:
        - name
        - surname
        - phone
        - personId
      properties:
        name:
          type: string
          example: Dawid
        surname:
          type: string
          example: Nowak
        phone:
          type: string
          format: phone
          example: 111222333
        personId:
          type: integer
          format: int64
    SmallRentalEntity:
      type: object
      required:
        - price
        - id
        - rentalDate
        - rentalStatus
        - placePlace
      properties:
        price:
          $ref: '#/components/schemas/Price'
        id:
          type: integer
          format: int64
        rentalDate:
          $ref: '#/components/schemas/RentalDate'
        rentalStatus:
          $ref: '#/components/schemas/RentalStatusTypeEnum'
        rentalPlace:
          $ref: '#/components/schemas/PlacesEnum'
    FullRentalEntity:
      type: object
      required:
        - rental
        - items
        - buyer
      properties:
        buyer:
          $ref: "#/components/schemas/BuyerEntity"
        rental:
          $ref: '#/components/schemas/SmallRentalEntity'
        items:
          type: array
          items:
            $ref: '#/components/schemas/ItemForRental'
    ItemForRental:
      type: object
      required:
        - item
        - price
      properties:
        item:
          $ref: '#/components/schemas/ItemMinimalInfo'
        price:
          $ref: '#/components/schemas/Price'
    ItemMinimalInfo:
      type: object
      required:
        - image
        - id
        - name
      properties:
        image:
          type: string
          example: "/Placeholder.png"
        id:
          type: integer
          format: int64
          example: 8
        name:
          type: string
          example: Pink Helmet
    PersonEntity:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 521
        phone:
          type: string
          example: 555000123
        name:
          type: string
          example: Tomek
        surname:
          type: string
          example: Nowak
        rank:
          $ref: '#/components/schemas/RankEnum'
    
    Response_ErrorModel:
      description: Schema for error response
      required:
        - timestamp
        - errors
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        errors:
          $ref: '#/components/schemas/ErrorsModel'
    Response_GetId:
      description: Schema for returning only id
      type: object
      required:
        - timestamp
        - id
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        id:
          type: integer
          format: int64
          description: Changed id
          example: 21
    Response_GetMultipleItems:
      description: Schema for getting multiple items
      type: object
      required:
        - timestamp
        - items
        - pages
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        items:
          type: array
          items:
            $ref: '#/components/schemas/ItemEntity'
        pages:
          $ref: '#/components/schemas/Pages'
    Response_GetSingleItem:
      description: Schema for getting single item
      type: object
      required:
        - timestamp
        - item
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        item:
          $ref: '#/components/schemas/ItemEntity'
    Response_GetSingleMaintenance:
      description: Schema for getting single Maintenance record
      required:
        - timestamp
        - maintenance
      type: object
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        maintenance:
          $ref: '#/components/schemas/MaintenanceEntity'
    Response_GetMultipleMaintenances:
      description: Schema for getting multiple Maintenance records
      required:
        - timestamp
        - maintenance
        - pages
      type: object
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        maintenance:
          type: array
          items:
            $ref: '#/components/schemas/MaintenanceEntity'
        pages:
          $ref: '#/components/schemas/Pages'
    Response_ItemCheck:
      description: Response for itemCheck
      required:
        - timestamp
        - valid
        - notValid
        - token
        - ttl
      properties:
        timestamp:
          $ref: "#/components/schemas/CurrentDate"
        valid:
          type: array
          items:
            $ref: '#/components/schemas/ItemEntity'
        notValid:
          type: array
          items:
            $ref: '#/components/schemas/ItemEntity'
        token:
          type: string
          format: uuid
        ttl:
          type: string
          format: date-time
    Response_GetMultipleRentals:
      description: Response for getting multiple rentals
      required:
        - timestamp
        - rentals
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        rentals:
          type: array
          items:
            $ref: '#/components/schemas/SmallRentalEntity'
        pages:
          $ref: '#/components/schemas/Pages'
    Response_GetSingleRental:
      description: Response for getting single full rental info
      required:
        - timestamp
        - rental
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        rental:
          $ref: '#/components/schemas/FullRentalEntity'
    Response_Auth:
      type: object
      required:
        - timestamp
        - jwt
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        jwt:
          type: string
    Response_AuthMe:
      type: object
      required:
        - timestamp
        - user
      properties:
        timestamp:
          $ref: '#/components/schemas/CurrentDate'
        user:
          $ref: '#/components/schemas/PersonEntity'